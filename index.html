<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Milky Forum</title>
    <style>
        /* CSS for black-themed, high-quality, animated UI/UX */
        :root {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --accent-color: #bb86fc;
            --secondary-color: #03dac6;
            --error-color: #cf6679;
            --card-bg: #1e1e1e;
            --border-radius: 8px;
            --transition: all 0.3s ease;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Live interactive background: animated gradient with particles */
        #background-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(45deg, #000000, #1a1a1a, #000000);
            background-size: 400% 400%;
            animation: gradientAnimation 15s ease infinite;
        }

        @keyframes gradientAnimation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1200px;
            width: 90%;
            padding: 20px;
            z-index: 1;
        }

        .auth-section, .main-section {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: var(--transition);
        }

        .auth-section:hover, .main-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.2);
        }

        input, button, textarea {
            background: #2c2c2c;
            border: 1px solid #3c3c3c;
            color: var(--text-color);
            padding: 10px;
            margin: 10px 0;
            border-radius: var(--border-radius);
            width: 100%;
            box-sizing: border-box;
            transition: var(--transition);
        }

        input:focus, textarea:focus {
            border-color: var(--accent-color);
            outline: none;
        }

        button {
            background: var(--accent-color);
            color: #000;
            cursor: pointer;
        }

        button:hover {
            background: var(--secondary-color);
        }

        .forum-list, .chat-section, .announcement, .users-section, .private-chat {
            margin-bottom: 20px;
        }

        .forum-card, .reply-card, .chat-message, .user-card {
            background: var(--card-bg);
            padding: 15px;
            margin: 10px 0;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .forum-card:hover, .reply-card:hover, .user-card:hover {
            transform: scale(1.02);
        }

        .admin-badge {
            background: var(--secondary-color);
            color: #000;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8em;
            margin-left: 5px;
        }

        .delete-btn, .ban-btn {
            background: var(--error-color);
            margin-left: 10px;
        }

        .hidden {
            display: none;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                width: 95%;
            }
        }

        /* Modern icons (using simple text for now, can add Font Awesome later) */
        .icon {
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <canvas id="background-canvas"></canvas>
    <div class="container">
        <!-- Auth Section -->
        <div id="auth-section" class="auth-section">
            <h2>Login or Sign Up</h2>
            <input id="username" type="text" placeholder="Username">
            <input id="password" type="password" placeholder="Password">
            <button id="login-btn">Login</button>
            <button id="signup-btn">Sign Up</button>
            <p id="auth-message"></p>
        </div>

        <!-- Main Section -->
        <div id="main-section" class="main-section hidden">
            <div class="header">
                <h2>Welcome, <span id="current-user"></span></h2>
                <button id="logout-btn">Logout</button>
            </div>

            <!-- Announcement Section -->
            <div class="announcement">
                <h3>Announcements</h3>
                <p id="announcement-text">Welcome to Milky Forum! Enjoy discussing topics locally.</p>
            </div>

            <!-- Forum Creation -->
            <div class="create-forum">
                <h3>Create New Forum</h3>
                <input id="forum-title" type="text" placeholder="Title">
                <textarea id="forum-content" placeholder="Content"></textarea>
                <button id="create-forum-btn">Create</button>
            </div>

            <!-- Forum List -->
            <div class="forum-list">
                <h3>Forums</h3>
                <div id="forums-container"></div>
            </div>

            <!-- Public Chat Section -->
            <div class="chat-section">
                <h3>Public Chat</h3>
                <div id="chat-messages" style="height: 200px; overflow-y: auto; background: #2c2c2c; padding: 10px; border-radius: var(--border-radius);"></div>
                <input id="chat-input" type="text" placeholder="Type a message...">
                <button id="send-chat-btn">Send</button>
            </div>

            <!-- Users Section for Private Chats and Ban -->
            <div class="users-section">
                <h3>Users</h3>
                <input id="user-search" type="text" placeholder="Search users...">
                <div id="users-list"></div>
            </div>

            <!-- Private Chat Section -->
            <div id="private-chat" class="private-chat hidden">
                <h3>Private Chat with <span id="chat-with"></span></h3>
                <div id="private-messages" style="height: 200px; overflow-y: auto; background: #2c2c2c; padding: 10px; border-radius: var(--border-radius);"></div>
                <input id="private-input" type="text" placeholder="Type a message...">
                <button id="send-private-btn">Send</button>
                <button id="close-private-btn">Close</button>
            </div>
        </div>
    </div>

    <script>
        // JavaScript for functionality
        const STORAGE_KEYS = {
            USERS: 'forum_users',
            SESSION: 'forum_session',
            FORUMS: 'forum_forums',
            PUBLIC_CHAT: 'forum_public_chat',
            PRIVATE_CHATS: 'forum_private_chats',
            ANNOUNCEMENT: 'forum_announcement',
            BANNED: 'forum_banned'
        };

        const ADMIN_USER = 'Milky';

        // Initialize data if not present
        if (!localStorage.getItem(STORAGE_KEYS.USERS)) {
            localStorage.setItem(STORAGE_KEYS.USERS, JSON.stringify([]));
        }
        if (!localStorage.getItem(STORAGE_KEYS.FORUMS)) {
            localStorage.setItem(STORAGE_KEYS.FORUMS, JSON.stringify([]));
        }
        if (!localStorage.getItem(STORAGE_KEYS.PUBLIC_CHAT)) {
            localStorage.setItem(STORAGE_KEYS.PUBLIC_CHAT, JSON.stringify([]));
        }
        if (!localStorage.getItem(STORAGE_KEYS.PRIVATE_CHATS)) {
            localStorage.setItem(STORAGE_KEYS.PRIVATE_CHATS, JSON.stringify({}));
        }
        if (!localStorage.getItem(STORAGE_KEYS.ANNOUNCEMENT)) {
            localStorage.setItem(STORAGE_KEYS.ANNOUNCEMENT, 'Welcome to Milky Forum! Enjoy discussing topics locally.');
        }
        if (!localStorage.getItem(STORAGE_KEYS.BANNED)) {
            localStorage.setItem(STORAGE_KEYS.BANNED, JSON.stringify([]));
        }

        // Elements
        const authSection = document.getElementById('auth-section');
        const mainSection = document.getElementById('main-section');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const loginBtn = document.getElementById('login-btn');
        const signupBtn = document.getElementById('signup-btn');
        const authMessage = document.getElementById('auth-message');
        const currentUserSpan = document.getElementById('current-user');
        const logoutBtn = document.getElementById('logout-btn');
        const forumTitleInput = document.getElementById('forum-title');
        const forumContentInput = document.getElementById('forum-content');
        const createForumBtn = document.getElementById('create-forum-btn');
        const forumsContainer = document.getElementById('forums-container');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const sendChatBtn = document.getElementById('send-chat-btn');
        const announcementText = document.getElementById('announcement-text');
        const userSearch = document.getElementById('user-search');
        const usersList = document.getElementById('users-list');
        const privateChat = document.getElementById('private-chat');
        const chatWith = document.getElementById('chat-with');
        const privateMessages = document.getElementById('private-messages');
        const privateInput = document.getElementById('private-input');
        const sendPrivateBtn = document.getElementById('send-private-btn');
        const closePrivateBtn = document.getElementById('close-private-btn');

        let currentPrivateChatUser = null;

        // Check session
        function checkSession() {
            const session = JSON.parse(localStorage.getItem(STORAGE_KEYS.SESSION));
            if (session) {
                const banned = JSON.parse(localStorage.getItem(STORAGE_KEYS.BANNED));
                if (banned.includes(session.username)) {
                    localStorage.removeItem(STORAGE_KEYS.SESSION);
                    showAuthSection();
                    authMessage.textContent = 'You are banned.';
                } else {
                    showMainSection(session.username);
                }
            } else {
                showAuthSection();
            }
        }

        function showAuthSection() {
            authSection.classList.remove('hidden');
            mainSection.classList.add('hidden');
        }

        function showMainSection(username) {
            authSection.classList.add('hidden');
            mainSection.classList.remove('hidden');
            currentUserSpan.innerHTML = `${username}${username === ADMIN_USER ? ' <span class="admin-badge">Developer</span>' : ''}`;
            loadForums();
            loadPublicChat();
            loadUsers();
            announcementText.textContent = localStorage.getItem(STORAGE_KEYS.ANNOUNCEMENT);
            if (username === ADMIN_USER) {
                const editAnnBtn = document.createElement('button');
                editAnnBtn.textContent = 'Edit Announcement';
                editAnnBtn.onclick = () => {
                    const newAnn = prompt('New Announcement:', announcementText.textContent);
                    if (newAnn) {
                        localStorage.setItem(STORAGE_KEYS.ANNOUNCEMENT, newAnn);
                        announcementText.textContent = newAnn;
                    }
                };
                document.querySelector('.announcement').appendChild(editAnnBtn);
            }
        }

        // Auth functions
        function signup() {
            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();
            if (!username || !password) {
                authMessage.textContent = 'Please enter username and password.';
                return;
            }
            let users = JSON.parse(localStorage.getItem(STORAGE_KEYS.USERS));
            if (users.find(u => u.username === username)) {
                authMessage.textContent = 'Username already exists.';
                return;
            }
            users.push({ username, password });
            localStorage.setItem(STORAGE_KEYS.USERS, JSON.stringify(users));
            authMessage.textContent = 'Signed up successfully. Now login.';
        }

        function login() {
            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();
            if (!username || !password) {
                authMessage.textContent = 'Please enter username and password.';
                return;
            }
            const users = JSON.parse(localStorage.getItem(STORAGE_KEYS.USERS));
            const user = users.find(u => u.username === username && u.password === password);
            if (!user) {
                authMessage.textContent = 'Invalid credentials.';
                return;
            }
            const banned = JSON.parse(localStorage.getItem(STORAGE_KEYS.BANNED));
            if (banned.includes(username)) {
                authMessage.textContent = 'You are banned.';
                return;
            }
            localStorage.setItem(STORAGE_KEYS.SESSION, JSON.stringify({ username }));
            showMainSection(username);
        }

        // Logout
        function logout() {
            localStorage.removeItem(STORAGE_KEYS.SESSION);
            showAuthSection();
        }

        // Forum functions
        function createForum() {
            const title = forumTitleInput.value.trim();
            const content = forumContentInput.value.trim();
            const username = getCurrentUser();
            if (!title || !content) return;
            let forums = JSON.parse(localStorage.getItem(STORAGE_KEYS.FORUMS));
            const id = Date.now();
            forums.push({ id, title, content, author: username, replies: [] });
            localStorage.setItem(STORAGE_KEYS.FORUMS, JSON.stringify(forums));
            forumTitleInput.value = '';
            forumContentInput.value = '';
            loadForums();
        }

        function loadForums() {
            forumsContainer.innerHTML = '';
            const forums = JSON.parse(localStorage.getItem(STORAGE_KEYS.FORUMS));
            const currentUser = getCurrentUser();
            const isAdmin = currentUser === ADMIN_USER;
            forums.forEach(forum => {
                const forumCard = document.createElement('div');
                forumCard.classList.add('forum-card');
                let repliesHtml = forum.replies.map(reply => `
                    <div class="reply-card">
                        <p>${reply.content} - by ${reply.author}${reply.author === ADMIN_USER ? ' <span class="admin-badge">Developer</span>' : ''} (to ${reply.replyTo})</p>
                        ${isAdmin ? `<button class="delete-btn" onclick="deleteReply(${forum.id}, ${reply.id})">Delete</button>` : ''}
                    </div>
                `).join('');
                forumCard.innerHTML = `
                    <h4>${forum.title}</h4>
                    <p>${forum.content} - by ${forum.author}${forum.author === ADMIN_USER ? ' <span class="admin-badge">Developer</span>' : ''}</p>
                    <div class="replies">${repliesHtml}</div>
                    <textarea class="reply-input" placeholder="Reply..."></textarea>
                    <button class="reply-btn">Reply</button>
                    ${isAdmin ? `<button class="delete-btn" onclick="deleteForum(${forum.id})">Delete Forum</button>` : ''}
                `;
                const replyInput = forumCard.querySelector('.reply-input');
                const replyBtn = forumCard.querySelector('.reply-btn');
                replyBtn.onclick = () => addReply(forum.id, replyInput.value.trim());
                forumsContainer.appendChild(forumCard);
            });
        }

        function addReply(forumId, content) {
            if (!content) return;
            const currentUser = getCurrentUser();
            let forums = JSON.parse(localStorage.getItem(STORAGE_KEYS.FORUMS));
            const forum = forums.find(f => f.id === forumId);
            const replies = forum.replies;
            if (forum.author === currentUser && replies.length === 0) {
                alert('You cannot reply to your own forum until someone else replies first.');
                return;
            }
            let replyTo = replies.length > 0 ? replies[replies.length - 1].author : forum.author;
            const id = Date.now();
            replies.push({ id, content, author: currentUser, replyTo });
            localStorage.setItem(STORAGE_KEYS.FORUMS, JSON.stringify(forums));
            loadForums();
        }

        function deleteForum(id) {
            if (!confirm('Delete forum?')) return;
            let forums = JSON.parse(localStorage.getItem(STORAGE_KEYS.FORUMS)).filter(f => f.id !== id);
            localStorage.setItem(STORAGE_KEYS.FORUMS, JSON.stringify(forums));
            loadForums();
        }

        function deleteReply(forumId, replyId) {
            if (!confirm('Delete reply?')) return;
            let forums = JSON.parse(localStorage.getItem(STORAGE_KEYS.FORUMS));
            const forum = forums.find(f => f.id === forumId);
            forum.replies = forum.replies.filter(r => r.id !== replyId);
            localStorage.setItem(STORAGE_KEYS.FORUMS, JSON.stringify(forums));
            loadForums();
        }

        // Public Chat functions
        function sendPublicChat() {
            const content = chatInput.value.trim();
            if (!content) return;
            const username = getCurrentUser();
            let chat = JSON.parse(localStorage.getItem(STORAGE_KEYS.PUBLIC_CHAT));
            const id = Date.now();
            chat.push({ id, content, author: username, timestamp: new Date().toISOString() });
            localStorage.setItem(STORAGE_KEYS.PUBLIC_CHAT, JSON.stringify(chat));
            chatInput.value = '';
            loadPublicChat();
        }

        function loadPublicChat() {
            chatMessages.innerHTML = '';
            const chat = JSON.parse(localStorage.getItem(STORAGE_KEYS.PUBLIC_CHAT));
            const currentUser = getCurrentUser();
            const isAdmin = currentUser === ADMIN_USER;
            chat.forEach(msg => {
                const msgDiv = document.createElement('div');
                msgDiv.classList.add('chat-message');
                msgDiv.innerHTML = `
                    <p>${msg.content} - by ${msg.author}${msg.author === ADMIN_USER ? ' <span class="admin-badge">Developer</span>' : ''} at ${new Date(msg.timestamp).toLocaleTimeString()}</p>
                    ${isAdmin ? `<button class="delete-btn" onclick="deletePublicChat(${msg.id})">Delete</button>` : ''}
                `;
                chatMessages.appendChild(msgDiv);
            });
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function deletePublicChat(id) {
            if (!confirm('Delete message?')) return;
            let chat = JSON.parse(localStorage.getItem(STORAGE_KEYS.PUBLIC_CHAT)).filter(m => m.id !== id);
            localStorage.setItem(STORAGE_KEYS.PUBLIC_CHAT, JSON.stringify(chat));
            loadPublicChat();
        }

        // Users and Ban
        function loadUsers(query = '') {
            usersList.innerHTML = '';
            const users = JSON.parse(localStorage.getItem(STORAGE_KEYS.USERS));
            const banned = JSON.parse(localStorage.getItem(STORAGE_KEYS.BANNED));
            const currentUser = getCurrentUser();
            const isAdmin = currentUser === ADMIN_USER;
            const filteredUsers = users.filter(u => u.username !== currentUser && u.username.toLowerCase().includes(query.toLowerCase()));
            filteredUsers.forEach(user => {
                const userCard = document.createElement('div');
                userCard.classList.add('user-card');
                userCard.innerHTML = `
                    <p>${user.username}${banned.includes(user.username) ? ' (Banned)' : ''}</p>
                    <button class="chat-btn">Chat</button>
                    ${isAdmin && !banned.includes(user.username) ? `<button class="ban-btn" onclick="banUser('${user.username}')">Ban</button>` : ''}
                `;
                const chatBtn = userCard.querySelector('.chat-btn');
                chatBtn.onclick = () => openPrivateChat(user.username);
                usersList.appendChild(userCard);
            });
        }

        function banUser(username) {
            if (getCurrentUser() !== ADMIN_USER || username === ADMIN_USER) return;
            if (confirm(`Ban ${username}?`)) {
                let banned = JSON.parse(localStorage.getItem(STORAGE_KEYS.BANNED));
                if (!banned.includes(username)) {
                    banned.push(username);
                    localStorage.setItem(STORAGE_KEYS.BANNED, JSON.stringify(banned));
                    loadUsers(userSearch.value.trim());
                }
            }
        }

        // Private Chat functions
        function openPrivateChat(targetUser) {
            if (currentPrivateChatUser === targetUser) return;
            currentPrivateChatUser = targetUser;
            chatWith.textContent = targetUser;
            privateChat.classList.remove('hidden');
            loadPrivateMessages();
        }

        function closePrivateChat() {
            privateChat.classList.add('hidden');
            currentPrivateChatUser = null;
        }

        function getPrivateChatKey(user1, user2) {
            return [user1, user2].sort().join('_');
        }

        function sendPrivateMessage() {
            const content = privateInput.value.trim();
            if (!content || !currentPrivateChatUser) return;
            const sender = getCurrentUser();
            let privateChats = JSON.parse(localStorage.getItem(STORAGE_KEYS.PRIVATE_CHATS));
            const key = getPrivateChatKey(sender, currentPrivateChatUser);
            if (!privateChats[key]) privateChats[key] = [];
            const id = Date.now();
            privateChats[key].push({ id, content, sender, timestamp: new Date().toISOString() });
            localStorage.setItem(STORAGE_KEYS.PRIVATE_CHATS, JSON.stringify(privateChats));
            privateInput.value = '';
            loadPrivateMessages();
        }

        function loadPrivateMessages() {
            if (!currentPrivateChatUser) return;
            privateMessages.innerHTML = '';
            let privateChats = JSON.parse(localStorage.getItem(STORAGE_KEYS.PRIVATE_CHATS));
            const key = getPrivateChatKey(getCurrentUser(), currentPrivateChatUser);
            const messages = privateChats[key] || [];
            const currentUser = getCurrentUser();
            const isAdmin = currentUser === ADMIN_USER;
            messages.forEach(msg => {
                const msgDiv = document.createElement('div');
                msgDiv.classList.add('chat-message');
                msgDiv.innerHTML = `
                    <p>${msg.content} - by ${msg.sender} at ${new Date(msg.timestamp).toLocaleTimeString()}</p>
                    ${isAdmin || msg.sender === currentUser ? `<button class="delete-btn" onclick="deletePrivateMessage('${key}', ${msg.id})">Delete</button>` : ''}
                `;
                privateMessages.appendChild(msgDiv);
            });
            privateMessages.scrollTop = privateMessages.scrollHeight;
        }

        function deletePrivateMessage(key, id) {
            if (!confirm('Delete message?')) return;
            let privateChats = JSON.parse(localStorage.getItem(STORAGE_KEYS.PRIVATE_CHATS));
            privateChats[key] = privateChats[key].filter(m => m.id !== id);
            localStorage.setItem(STORAGE_KEYS.PRIVATE_CHATS, JSON.stringify(privateChats));
            loadPrivateMessages();
        }

        function getCurrentUser() {
            const session = JSON.parse(localStorage.getItem(STORAGE_KEYS.SESSION));
            return session ? session.username : null;
        }

        // Real-time simulation using storage event
        window.addEventListener('storage', (event) => {
            if (event.key === STORAGE_KEYS.FORUMS) {
                loadForums();
            } else if (event.key === STORAGE_KEYS.PUBLIC_CHAT) {
                loadPublicChat();
            } else if (event.key === STORAGE_KEYS.PRIVATE_CHATS) {
                loadPrivateMessages();
            } else if (event.key === STORAGE_KEYS.ANNOUNCEMENT) {
                announcementText.textContent = localStorage.getItem(STORAGE_KEYS.ANNOUNCEMENT);
            } else if (event.key === STORAGE_KEYS.BANNED || event.key === STORAGE_KEYS.USERS) {
                loadUsers(userSearch.value.trim());
            }
        });

        // Event listeners
        loginBtn.onclick = login;
        signupBtn.onclick = signup;
        logoutBtn.onclick = logout;
        createForumBtn.onclick = createForum;
        sendChatBtn.onclick = sendPublicChat;
        userSearch.oninput = () => loadUsers(userSearch.value.trim());
        sendPrivateBtn.onclick = sendPrivateMessage;
        closePrivateBtn.onclick = closePrivateChat;

        // Initial check
        checkSession();

        // Background particles
        const canvas = document.getElementById('background-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let particles = [];
        for (let i = 0; i < 100; i++) {
            particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                radius: Math.random() * 2 + 1,
                vx: Math.random() * 1 - 0.5,
                vy: Math.random() * 1 - 0.5
            });
        }

        function drawParticles() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
            particles.forEach(p => {
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
                ctx.fill();
                p.x += p.vx;
                p.y += p.vy;
                if (p.x < 0 || p.x > canvas.width) p.vx = -p.vx;
                if (p.y < 0 || p.y > canvas.height) p.vy = -p.vy;
            });
            requestAnimationFrame(drawParticles);
        }

        drawParticles();

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>
